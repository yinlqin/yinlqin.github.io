!function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/dist/",t(t.s=346)}({206:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",function(){return c});var i=n(350),r=n(5),a=n(351),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),c=function(){function e(){var t=this;o(this,e),this.seedId(),this.children=[],this.view=new i.a,this.meta={tag:"div",classList:[],styles:{},attributes:{}},this.defaultMeta={tag:"div",classList:[],styles:{},attributes:{}},this.initStates(),this.mouseFollower={offsetX:10,offsetY:0},this.begindrag=function(e){e.stopPropagation(),t.state.onBegindrag(e)},this.begindragLabel=function(e){t.view.$dom&&(t.mouseFollower.offsetX=e.offsetX,t.mouseFollower.offsetY=-18+e.offsetY),t.begindrag(e)},this.begindragIcon=function(e){t.view.$dom&&(t.mouseFollower.offsetX=t.view.$dom.clientWidth-96+e.offsetX,t.mouseFollower.offsetY=-24+e.offsetY),t.begindrag(e)},this.mousemove=function(e){e.stopPropagation(),t.state.onMousemove(e),rxEditor.canvasMouseMove(e)},this.mouseover=function(e){e.stopPropagation(),t.state.onMouseover(e)},this.mouseout=function(e){e.stopPropagation(),t.state.onMouseout(e)},this.onclick=function(e){e.stopPropagation(),t.state.onClick(e)},this.duplicate=function(){t.changeToState("normalState"),rxEditor.commandManager.duplicate(t),rxEditor.render()},this.up=function(e){t.parent&&(t.changeToState("normalState"),t.parent.changeToState("focusState"),e.stopPropagation())},this.delete=function(){t.changeToState("normalState"),rxEditor.commandManager.deleteNode(t),rxEditor.render()},this.stateChanged=function(e,n){e.leave(),n.enter(),rxEditor.nodeStateChanged(t,e,n)}}return s(e,[{key:"seedId",value:function(){e.idSeed||(e.idSeed=1),e.idSeed++,this.id=e.idSeed}},{key:"initStates",value:function(){this.normalState=new a.g(this),this.activeState=new a.a(this),this.focusState=new a.f(this),this.dragoverState=new a.d(this),this.draggedState=new a.c(this),this.disableState=new a.b(this),this.editState=new a.e(this),this.previewState=new a.h(this),this.state=this.normalState}},{key:"markDefaultMeta",value:function(){this.defaultMeta.tag=this.meta.tag,this.defaultMeta.classList=this.meta.classList.concat(),this.defaultMeta.attributes=Object.assign({},this.meta.attributes),this.defaultMeta.styles=Object.assign({},this.meta.styles)}},{key:"changeToState",value:function(e){if(this.state!==this[e]){var t=this.state;this.state=this[e],this.refreshState(),this.stateChanged(t,this[e])}}},{key:"render",value:function(){this.view.render(this.toViewModel(),this.getParentViewDomElement()),this.children.forEach(function(e){e.render()})}},{key:"renderHtml",value:function(e){var t=this.view.renderHtml(this.toHtmlModel(),e);return this.children.forEach(function(e){e.renderHtml(t)}),e.appendChild(t),t}},{key:"refreshState",value:function(){this.view.refreshState(this.toViewModel()),this.children.forEach(function(e){e.refreshState()})}},{key:"clearDraggedoverStates",value:function(){this.state===this.dragoverState&&this.changeToState("normalState"),this.children.forEach(function(e){e.clearDraggedoverStates()})}},{key:"clearActiveStates",value:function(){this.state===this.activeState&&this.changeToState("normalState"),this.children.forEach(function(e){e.clearActiveStates()})}},{key:"clearFocusAndEditStates",value:function(){this.state!==this.focusState&&this.state!==this.editState||this.changeToState("normalState"),this.children.forEach(function(e){e.clearFocusAndEditStates()})}},{key:"allToNormalState",value:function(){this.changeToState("normalState"),this.children.forEach(function(e){e.allToNormalState()})}},{key:"draggedToFoused",value:function(){this.state===this.draggedState&&this.changeToState("focusState"),this.children.forEach(function(e){e.draggedToFoused()})}},{key:"getParentViewDomElement",value:function(){return this.parent.view.$dom}},{key:"firstChild",value:function(){return Object(r.e)(this.children)}},{key:"nextSbiling",value:function(){if(this.parent)return Object(r.b)(this,this.parent.children)}},{key:"previousSbiling",value:function(){if(this.parent)return Object(r.c)(this,this.parent.children)}},{key:"moveInTop",value:function(e){Object(r.e)(e.children)!==this&&(this.removeFromParent(),e.unshiftChild(this),e.render())}},{key:"moveIn",value:function(e){Object(r.h)(e.children)!==this&&(this.removeFromParent(),e.pushChild(this),e.render())}},{key:"moveBefore",value:function(e){Object(r.c)(e,this.children)!==this&&(this.removeFromParent(),this.parent=e.parent,Object(r.g)(this,e,e.parent.children),this.parent.render())}},{key:"moveAfter",value:function(e){Object(r.b)(e,this.children)!==this&&(this.removeFromParent(),this.parent=e.parent,Object(r.f)(this,e,e.parent.children),this.parent.render())}},{key:"removeFromParent",value:function(){this.parent&&(Object(r.i)(this,this.parent.children),this.parent.render())}},{key:"unshiftChild",value:function(e){return e.parent=this,this.children.unshift(e),this}},{key:"pushChild",value:function(e){return e.parent=this,Object(r.a)(e,this.children),this}},{key:"insertAfterSelf",value:function(e){return e.parent=this.parent,Object(r.f)(e,this,this.parent.children),this}},{key:"clone",value:function(){var e=this.make();return e.rule=JSON.parse(JSON.stringify(this.rule)),e.ruleName=this.ruleName,this.children.forEach(function(t){e.pushChild(t.clone())}),e}},{key:"canAccept",value:function(e){var t=this.rule?this.rule.acceptedChildren:"";return(!t||0!=t.length)&&(!(t&&!this.containsInAccepted(e))&&!(!t&&this.containsInExcept(e)))}},{key:"containsInAccepted",value:function(e){for(var t=e.ruleName,n=this.rule?this.rule.acceptedChildren:"",o=0;o<n.length;o++)if(n[o]===t)return!0;return!1}},{key:"containsInExcept",value:function(e){var t=e.ruleName,n=this.rule?this.rule.rejectChildren:"";if(n)for(var o=0;o<n.length;o++)if(n[o]===t)return!0;return!1}},{key:"toViewModel",value:function(){var e=this.state.stateModel();return e.on={onmousemove:this.mousemove,onmouseover:this.mouseover,onmouseout:this.mouseout,onclick:this.onclick},e}},{key:"toHtmlModel",value:function(){return{styles:{},classList:[],attributes:{}}}},{key:"toTreeViewNode",value:function(){var e={label:this.label,tag:this.meta.tag,id:this.id,state:this.getStateName(),children:[]};return this.children.forEach(function(t){var n=t.toTreeViewNode();n&&e.children.push(n)}),e}},{key:"getStateName",value:function(){return this.state===this.normalState?"normalState":this.state===this.activeState?"activeState":this.state===this.focusState?"focusState":this.state===this.dragoverState?"dragoverState":this.state===this.draggedState?"draggedState":this.state===this.disableState?"disableState":void 0}},{key:"nodeChanged",value:function(e){if(this.id===e.id)return void rxEditor.commandManager.changeNode(this,e);this.children.forEach(function(t){t.nodeChanged(e)})}},{key:"focusNode",value:function(e){e.id===this.id?this.changeToState("focusState"):this.changeToState("normalState"),this.children.forEach(function(t){t.focusNode(e)})}},{key:"clearCharNodes",value:function(){this.children.forEach(function(e){e.clearCharNodes()})}},{key:"getNodeById",value:function(e){if(e===this.id)return this;for(var t in this.children){var n=this.children[t].getNodeById(e);if(n)return n}}},{key:"preview",value:function(){this.changeToState("previewState"),this.children.forEach(function(e){e.preview()})}}]),e}()},233:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",function(){return a});var i=n(5),r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=function(){function e(){o(this,e),this.envetHandlers={}}return r(e,[{key:"watch",value:function(e,t){this.envetHandlers[e]||(this.envetHandlers[e]=[]),Object(i.d)(t,this.envetHandlers[e])||this.envetHandlers[e].push(t)}},{key:"cancelWatch",value:function(e,t){console.assert(this.envetHandlers[e],"EditorState: did not register this event handler"),Object(i.i)(t,this.envetHandlers[e])}},{key:"distributeEvent",value:function(e){this.distributeEventWithoutGlobal(e),this.distributeEventWithoutGlobal("changed")}},{key:"distributeEventWithoutGlobal",value:function(e){var t=this,n=this.envetHandlers[e];n&&n.forEach(function(e){e(t)})}}]),e}()},234:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",function(){return r});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=function(){function e(t){var n=this;o(this,e),this.pageId=t,window.addEventListener("message",function(e){n.pageId===e.data.pageId&&n.handleMessage(e.data)}),this.focusNode=function(e,t){n.sendMessage({name:"focusNode",pageId:t,node:{id:e.id,ruleName:e.ruleName,meta:e.meta,defaultMeta:e.defaultMeta,optionsSchema:e.rule.optionsSchema,htmlCode:e.htmlCode}})},this.unFocusNode=function(e){n.sendMessage({name:"unFocusNode",id:e.id})},document.addEventListener("mouseup",function(e){n.sendMessage({name:"canvasMouseup"})}),document.addEventListener("mousemove",function(e){n.canvasMouseMove(e)})}return i(e,[{key:"canvasMouseMove",value:function(e){this.sendMessage({name:"canvasMouseMove",event:{screenX:e.screenX,screenY:e.screenY}})}},{key:"rxeditorReady",value:function(){this.sendMessage({name:"rxeditorReady"})}},{key:"commandExcuted",value:function(e,t,n){this.sendMessage({name:"commandExcuted",canUndo:e,canRedo:t,commandSchema:n})}},{key:"takeOverDraggingByWorkspace",value:function(){this.sendMessage({name:"takeOverDraggingByWorkspace"})}},{key:"saveCodeFiles",value:function(e,t){this.sendMessage({name:"saveCodeFiles",innerHTML:e,json:t})}},{key:"handleMessage",value:function(e){switch(e.name){case"requestAssemble":var t=this.serveForRXEditor.assembleWithTheme(e.theme);this.sendMessage({name:"replyAssemble",toolbox:t.toolbox,treeViewNodes:t.treeViewNodes});break;case"draggingFromToolbox":this.serveForRXEditor.dragFromToolbox(e.item);break;case"endDragFromToolbox":this.serveForRXEditor.endDragFromToolbox(e.rxNameId);break;case"changeCanvasState":this.serveForRXEditor.changeCanvasState(e.state);break;case"nodeChanged":this.serveForRXEditor.nodeChanged(e.node);break;case"undo":this.serveForRXEditor.undo();break;case"redo":this.serveForRXEditor.redo();break;case"clearCanvas":this.serveForRXEditor.clearCanvas();break;case"changeTheme":this.serveForRXEditor.changeTheme(e.theme);break;case"focusNodeFromShell":this.serveForRXEditor.focusNodeFromShell(e.node);break;case"duplicateNodeFromShell":this.serveForRXEditor.duplicateNodeFromShell(e.id);break;case"removeNodeFromShell":this.serveForRXEditor.removeNodeFromShell(e.id);break;case"requestHtmlCode":var n=this.serveForRXEditor.requestHtmlCode();this.sendMessage({name:"replyHtmlCode",htmlCode:n});break;case"loadHtml":this.serveForRXEditor.loadHtml(e.html,e.id);break;case"setInlineFile":this.serveForRXEditor.setInlineFile(e.file)}}},{key:"sendMessage",value:function(e){e.pageId=this.pageId,e.canvasHeight=document.body.scrollHeight,window.parent.postMessage(e,"/")}}]),e}()},235:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}n.d(t,"a",function(){return l});var a=n(206),s=n(236),c=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),u=function e(t,n,o){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,n,o)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(o)},l=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return r(t,e),c(t,[{key:"clone",value:function(){var e=u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clone",this).call(this);return e.meta=JSON.parse(JSON.stringify(this.meta)),e.defaultMeta=JSON.parse(JSON.stringify(this.defaultMeta)),e.label=this.label,e}},{key:"setLabel",value:function(e){return this.label=e,this.labelToCapitalize(),this}},{key:"labelToCapitalize",value:function(){var e=this.label;this.label=e.replace(e[0],e[0].toUpperCase())}},{key:"toViewModel",value:function(){var e=u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toViewModel",this).call(this);return this.baseMetaToModel(e),this.meta.innerHTML&&(e.innerHTML=this.meta.innerHTML),e}},{key:"toHtmlModel",value:function(){var e=u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toHtmlModel",this).call(this);return this.baseMetaToModel(e),e}},{key:"baseMetaToModel",value:function(e){var t=this.meta;e.tag=t.tag,e.innerHTML=t.innerHTML,e.classList.push.apply(e.classList,t.classList),Object.assign(e.styles,t.styles),Object.assign(e.attributes,t.attributes)}},{key:"setTag",value:function(e){return this.setField("tag",e)}},{key:"addClass",value:function(e){return e?(this.meta.classList.push(e),this):this}},{key:"setAttribute",value:function(e,t){return this.meta.attributes[e]=t,this}},{key:"changeTextnodeToCharNode",value:function(){var e=this,t=[];this.children.forEach(function(n){n.isTextNode?(t.push.apply(t,n.charNodes()),e.isCharState=!0):t.push(n)}),this.children=t,this.render()}},{key:"changeCharNodeToTextNode",value:function(){var e=this,t=[],n=null;this.children.forEach(function(o){if(o.isCharNode){var i=o.previousSbiling();i&&i.isCharNode||(n=new s.a(""),n.parent=e,t.push(n)),n.text+=o.char}else t.push(o)}),this.children=t,this.render(),this.isCharState=!1}},{key:"clearCharNodes",value:function(){this.isCharState&&this.changeCharNodeToTextNode(),u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clearCharNodes",this).call(this)}}]),t}(a.a)},236:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",function(){return a});var i=n(361),r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=function(){function e(t){o(this,e),this.text=t,this.seedId(),this.isTextNode=!0}return r(e,[{key:"seedId",value:function(){e.idSeed||(e.idSeed=1),e.idSeed++,this.id="text"+e.idSeed}},{key:"make",value:function(){return new e(this.text)}},{key:"clone",value:function(){return this.make()}},{key:"getParentViewDomElement",value:function(){return this.parent.view.$dom}},{key:"render",value:function(){var e=this.getParentViewDomElement();e&&e.appendChild(document.createTextNode(this.text))}},{key:"renderHtml",value:function(e){e&&e.appendChild(document.createTextNode(this.text))}},{key:"renderMouseFollower",value:function(e){var t=document.createTextNode(this.text);return e.appendChild(t),t}},{key:"preview",value:function(){}},{key:"nodeChanged",value:function(){}},{key:"refreshState",value:function(){}},{key:"clearDraggedoverStates",value:function(){}},{key:"clearActiveStates",value:function(){}},{key:"clearFocusAndEditStates",value:function(){}},{key:"clearCharNodes",value:function(){}},{key:"draggedToFoused",value:function(){}},{key:"focusNode",value:function(){}},{key:"allToNormalState",value:function(){}},{key:"toTreeViewNode",value:function(){return null}},{key:"getNodeById",value:function(){}},{key:"charNodes",value:function(){for(var e=[],t=0;t<this.text.length;t++)e.push(new i.a(this.text[t],this.parent));return e}}]),e}()},237:function(e,t,n){"use strict";t.a={dropInMargin:10,editable:!0,editMarginStyle:{paddingX:"10px",paddingY:"10px"},empertyMargin:!1,rejectChildren:["col","thead","tbody","th","tr","td"]}},346:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(347);window.creatEditorCore=function(e){Object(o.a)(e)}},347:function(e,t,n){"use strict";function o(e){window.rxEditor=new i.a(e),window.RXEditorCommandProxy=r.a}t.a=o;var i=n(348),r=n(234)},348:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(){var e=navigator.language||navigator.userLanguage;return e=e.substr(0,2),"zh"!==e&&(e="en"),e}function r(e){var t="zh"===i()?b:g;return t[e]?t[e]:e}n.d(t,"a",function(){return w});var a=n(349),s=n(352),c=n(5),u=n(353),l=n(354),h=n(355),d=n(356),f=n(357),m=n(358),p=n(234),v=n(359),y=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),g={"focus-parent":"Focus Parent",move:"Move",edit:"Edit",duplicate:"Duplicate",delete:"Delete","can-be-draged":"Can be draged"},b={"focus-parent":"选中父节点",move:"拖动",edit:"编辑",duplicate:"克隆",delete:"删除","can-be-draged":"可以拖动"},w=function(){function e(t){var n=this;o(this,e),this.pageId=t,window.$t=r,this.state=new s.a,this.commandManager=new u.a,this.commandManager.onCommandsChanged=function(e,t,o){o&&(o.parentId===n.canvas.id&&(o.parentId=""),o.oldParentId===n.canvas.id&&(o.oldParentId=""),n.commandProxy.commandExcuted(e,t,o))},this.optionClasses=[],Object(c.a)("rx-_-show-outline",this.optionClasses),this.activedLabel=new l.a,this.focusedLabel=new l.a,this.focusedLabel.cssClass("focused"),this.focusedLabel.domOn("mousedown",function(e){rxEditor.focusedNode&&rxEditor.focusedNode.begindragLabel(e)}),this.toolbar=new h.a,this.cursor=new d.a,this.mouseFollower=new f.a,this.miniEditbar=new m.a,this.nodeParser=new v.a}return y(e,[{key:"hangOn",value:function(e){var t=this,n=new p.a(this.pageId);this.workspace=document.getElementById(e),this.activedLabel.render(this.workspace),this.focusedLabel.render(this.workspace),this.toolbar.render(this.workspace),this.cursor.render(this.workspace),this.mouseFollower.render(this.workspace),this.miniEditbar.render(this.workspace),this.canvas=new a.a(this.workspace),this.canvas.render(),n.serveForRXEditor=this,this.commandProxy=n,this.commandProxy.rxeditorReady(),document.addEventListener("mouseup",function(e){t.dropElement(e)}),this.state.watch("changed",function(e){}),this.state.watch("showOutline",function(e){Object(c.j)(e.showOutline,"rx-_-show-outline",t.optionClasses),t.render()}),this.state.watch("showMarginX",function(e){t.render()}),this.state.watch("showMarginY",function(e){t.render()})}},{key:"render",value:function(){this.canvas.render(),this.toolbar.refreshPosition(),this.focusedLabel.refreshPosition()}},{key:"clearDraggedoverStates",value:function(){this.canvas.clearDraggedoverStates()}},{key:"clearActiveStates",value:function(){this.canvas.clearActiveStates()}},{key:"clearFocusAndEditStates",value:function(){this.canvas.clearFocusAndEditStates()}},{key:"allToNormalState",value:function(){this.canvas.allToNormalState()}},{key:"dragFromToolbox",value:function(e){if(!this.commandManager.movingCommand){this.clearFocusAndEditStates();var t=this.parseNode(e);this.commandManager.startNew(t),this.beginFollowMouse()}}},{key:"parseNode",value:function(e){var t=this.state.screenWidth;return this.nodeParser.parse(e.code.replace("--responsive--","xs"==t?"":"-"+t))[0]}},{key:"dropElement",value:function(e){this.doDrop(e),this.commandManager.finishMoving(),this.endFollowMouse(),this.canvas.clearCharNodes()}},{key:"doDrop",value:function(e){var t=this.cursor.position,n=this.cursor.node;if(!n)return void this.canvas.draggedToFoused();this.canvas.clearFocusAndEditStates();var o=this.commandManager.movingCommand;o&&("in-left"===t||"in-top"===t?(o.adoptFromToolbox(n),o.moveInTop(n),o.finish()):"in-right"===t||"in-bottom"===t?(o.adoptFromToolbox(n),o.moveIn(n),o.finish()):"out-left"===t||"out-top"===t||"char-left"===t?(o.adoptFromToolbox(n),o.moveBefore(n),o.finish()):"out-right"!==t&&"out-bottom"!==t&&"char-right"!==t||(o.adoptFromToolbox(n),o.moveAfter(n),o.finish()))}},{key:"endDragFromToolbox",value:function(){this.commandManager.finishMoving(),this.endFollowMouse()}},{key:"followMouse",value:function(e){this.mouseFollower.isActived&&(this.mouseFollower.followMouse(e),this.commandProxy.takeOverDraggingByWorkspace())}},{key:"beginFollowMouse",value:function(){if(this.commandManager.movingCommand){var e=this.commandManager.movingCommand.node;this.mouseFollower.active(e.label)}}},{key:"endFollowMouse",value:function(){this.cursor.hide(),this.mouseFollower.hide()}},{key:"nodeStateChanged",value:function(e,t,n){n===e.focusState&&e.focusState!==e.normalState&&(e.htmlCode=this.getNodeHtml(e),this.commandProxy.focusNode(e,this.pageId)),t===e.focusState&&n!==e.focusState&&this.commandProxy.unFocusNode(e)}},{key:"getNodeHtml",value:function(e){var t=document.createElement("div");return e.renderHtml(t),t.innerHTML}},{key:"changeCanvasState",value:function(e){this.state.screenWidth=e.screenWidth,this.state.showMarginX=e.showMarginX,this.state.showMarginY=e.showMarginY,this.state.showOutline=e.showOutline,this.state.showLabel=e.showLabel}},{key:"nodeChanged",value:function(e){this.canvas.nodeChanged(e),this.render()}},{key:"undo",value:function(){this.allToNormalState(),this.commandManager.undo(),this.render()}},{key:"redo",value:function(){this.allToNormalState(),this.commandManager.redo(),this.render()}},{key:"clearCanvas",value:function(){this.commandManager.clearCanvas(),this.activedLabel.hide(),this.focusedLabel.hide(),this.toolbar.hide(),this.render()}},{key:"focusNodeFromShell",value:function(e){this.canvas.clearFocusAndEditStates(),this.canvas.focusNode(e)}},{key:"duplicateNodeFromShell",value:function(e){this.canvas.clearFocusAndEditStates();var t=this.canvas.getNodeById(e);this.commandManager.duplicate(t)}},{key:"removeNodeFromShell",value:function(e){this.canvas.clearFocusAndEditStates();var t=this.canvas.getNodeById(e);this.commandManager.deleteNode(t)}},{key:"canvasMouseMove",value:function(e){this.commandProxy.canvasMouseMove(e)}},{key:"requestHtmlCode",value:function(){return this.allToNormalState(),this.canvas.generateHTML()}},{key:"loadHtml",value:function(e,t){var n=this.canvas.getNodeById(t);n?this.commandManager.loadNodeHtml(n,e):this.commandManager.loadCanvasHtml(e),this.render()}},{key:"setInlineFile",value:function(e){var t=e.name.replace(".","-"),n=document.getElementById(t);if(n)return void(n.innerHTML=e.code);if("style"===e.fileType){var o=document.createElement("style");o.type="text/css",o.rel="stylesheet",o.id=t,o.appendChild(document.createTextNode(e.code));document.getElementsByTagName("head")[0].appendChild(o)}if("javascript"===e.fileType){var i=document.createElement("script");i.type="text/javascript",i.id=t,i.appendChild(document.createTextNode(e.code)),document.body.appendChild(i)}}}]),e}()},349:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}n.d(t,"a",function(){return u});var a=n(206),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),c=function e(t,n,o){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,n,o)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(o)},u=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.activeState=n.normalState,n.focusState=n.normalState,n.parentViewDomElement=e,n.padding="30px",n.stateChanged=function(e,t){},n.rule={dropInMargin:0},n.rule.acceptedChildren="",n.rule.rejectChildren=["col","thead","tbody","th","tr","td"],n}return r(t,e),s(t,[{key:"getParentViewDomElement",value:function(){return this.parentViewDomElement}},{key:"toViewModel",value:function(){var e=c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toViewModel",this).call(this);return e.tag="div",e.styles.width="100%",e.styles["min-height"]="calc(100vh)",e.styles.cursor="default",e.styles.border="0",e.styles.padding="10px",e.classList.push("canvas"),e.toolbar="",e.label="",e}},{key:"toPreviewModel",value:function(){var e=c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toPreviewModel",this).call(this);return e.tag="div",e}},{key:"generateHTML",value:function(){var e=document.createElement("div");return this.children.forEach(function(t){t.renderHtml(e)}),e.innerHTML}},{key:"generateJson",value:function(){var e=[];return this.children.forEach(function(t){e.push(t.toJson())}),e}},{key:"generateTreeViewNodes",value:function(){var e=[];return this.children.forEach(function(t){e.push(t.toTreeViewNode())}),e}}]),t}(a.a)},350:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",function(){return r});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=function(){function e(){o(this,e)}return i(e,[{key:"render",value:function(e,t){this.parentDoment=t;var n=this.$dom;this.$dom=document.createElement(e.tag),this.doRender(e,t,this.$dom),t.contains(n)?t.replaceChild(this.$dom,n):t.appendChild(this.$dom)}},{key:"renderHtml",value:function(e,t){var n=document.createElement(e.tag);return this.doRender(e,t,n),n}},{key:"refreshState",value:function(e){this.$dom&&(this.$dom.classList.remove("rx-_-mouse-overed","rx-_-focused","rx-_-dragged","rx-_-dragover","rx-_-editing"),this.renderStylesAndClasses(e,this.$dom),this.showAttributes(e,this.$dom))}},{key:"doRender",value:function(e,t,n){n.innerHTML=e.innerHTML?e.innerHTML:"",this.renderStylesAndClasses(e,n),this.bindEvents(n,e.on),this.showAttributes(e,n)}},{key:"renderStylesAndClasses",value:function(e,t){if(t){if(e.styles)for(var n in e.styles)t.style[n]=e.styles[n];e.classList.forEach(function(e){e&&t.classList.add(e)})}}},{key:"showAttributes",value:function(e,t){for(var n in e.attributes)e.attributes[n]&&t.setAttribute(n,e.attributes[n])}},{key:"bindEvents",value:function(e,t){for(var n in t)e[n]=t[n]}},{key:"putDown",value:function(){this.$dom&&this.parentDoment.contains(this.$dom)&&this.parentDoment.removeChild(this.$dom)}}]),e}()},351:function(e,t,n){"use strict";function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"g",function(){return u}),n.d(t,"d",function(){return l}),n.d(t,"a",function(){return h}),n.d(t,"f",function(){return d}),n.d(t,"b",function(){return f}),n.d(t,"c",function(){return m}),n.d(t,"e",function(){return p}),n.d(t,"h",function(){return v});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=function(){function e(t){r(this,e),this.node=t,this.classList=[],this.styles={},this.attributes={},this.onMousemove=function(){},this.onBegindrag=function(){},this.onMouseover=function(e){},this.onMouseout=function(){},this.onClick=function(){rxEditor.clearFocusAndEditStates()},this.enter=function(){},this.leave=function(){}}return a(e,[{key:"stateModel",value:function(){var e=[];e.push.apply(e,this.classList);var t={styles:Object.assign({},this.styles),classList:e,attributes:Object.assign({},this.attributes)};return this.addtionToModel(t),t}},{key:"addtionToModel",value:function(e){e.classList.push.apply(e.classList,rxEditor.optionClasses);var t=this.node;return(rxEditor.state.showMarginX&&t.rule.editMarginStyle||0===t.children.length&&t.rule.empertyMargin)&&(e.styles["padding-left"]=t.rule.editMarginStyle?t.rule.editMarginStyle.paddingX:0,e.styles["padding-right"]=t.rule.editMarginStyle?t.rule.editMarginStyle.paddingX:0),(rxEditor.state.showMarginY&&t.rule.editMarginStyle||0===t.children.length&&t.rule.empertyMargin)&&(e.styles["padding-top"]=t.rule.editMarginStyle?t.rule.editMarginStyle.paddingY:0,e.styles["padding-bottom"]=t.rule.editMarginStyle?t.rule.editMarginStyle.paddingY:0),e.attributes.for&&(e.attributes.for=""),e.attributes.draggable="false",e}},{key:"judgePosition",value:function(e){var t=rxEditor.commandManager.movingCommand.node;if(this.node.isCharNode)return this.judgeCharNodePostion(e);var n=this.node.rule.dropInMargin;n=n||0;var o=e.srcElement.clientWidth,i=e.srcElement.clientHeight,r=e.offsetX,a=e.offsetY,s=a/i,c=r/o;if(n>0&&(this.node.parent&&this.node.parent.canAccept(t)||!this.node.parent)){if(a<n&&r<n)return s<c?"out-top":"out-left";if(a<n&&o-r<n)return s<1-c?"out-top":"out-right";if(i-a<n&&o-r<n)return 1-s<1-c?"out-bottom":"out-right";if(i-a<n&&r<n)return 1-s<c?"out-bottom":"out-left";if(a<n)return"out-top";if(r<n)return"out-left";if(i-a<n)return"out-bottom";if(o-r<n)return"out-right"}if(this.node.canAccept(t)){if(this.inTop(e)&&this.inLeft(e))return s<c?"in-top":"in-left";if(this.inTop(e)&&!this.inLeft(e))return s<1-c?"in-top":"in-right";if(!this.inTop(e)&&this.inLeft(e))return 1-s<c?"in-bottom":"in-left";if(!this.inTop(e)&&!this.inLeft(e))return 1-s<1-c?"in-bottom":"in-right"}}},{key:"judgeCharNodePostion",value:function(e){return this.inLeft(e)?"char-left":"char-right"}},{key:"inTop",value:function(e){return e.srcElement.clientHeight>2*e.offsetY}},{key:"inLeft",value:function(e){return e.srcElement.clientWidth>2*e.offsetX}}]),e}(),c=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onMousemove=function(e){n.doDragover(e),rxEditor.followMouse(e)},n.onClick=function(e){rxEditor.clearFocusAndEditStates(),n.node.changeToState("focusState")},n}return i(t,e),a(t,[{key:"doDragover",value:function(e){rxEditor.commandManager.movingCommand&&(this.judgePosition(e)&&(this.node.changeToState("dragoverState"),rxEditor.cursor.show(this.judgePosition(e),this.node)))}}]),t}(s),u=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onMouseover=function(e){rxEditor.commandManager.movingCommand||(rxEditor.clearActiveStates(),n.node.changeToState("activeState"))},n}return i(t,e),t}(c),l=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.classList.push("rx-_-dragover"),n.enter=function(){e.changeTextnodeToCharNode(),n.node.isCharNode||rxEditor.activedLabel.show(e.label,e,1)},n.leave=function(){rxEditor.activedLabel.hide()},n.onMouseout=function(){n.node.changeToState("normalState")},n}return i(t,e),t}(c),h=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.classList.push("rx-_-mouse-overed"),n.enter=function(){rxEditor.activedLabel.show(e.label,e,1)},n.leave=function(){rxEditor.activedLabel.hide()},n.onMouseout=function(){n.node.changeToState("normalState")},n.onMouseover=function(e){rxEditor.commandManager.movingCommand||(rxEditor.clearActiveStates(),n.node.changeToState("activeState"))},n}return i(t,e),t}(c),d=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.classList.push("rx-_-focused"),n.enter=function(){e.view.$dom;rxEditor.focusedLabel.show(e.label,e,2),rxEditor.toolbar.show(e),rxEditor.focusedNode=e},n.leave=function(){rxEditor.focusedLabel.hide(),rxEditor.toolbar.hide(),rxEditor.focusedNode=""},n.onClick=function(e){e.stopPropagation()},n.onBegindrag=function(e){n.preventDefault,rxEditor.commandManager.startMove(n.node),rxEditor.beginFollowMouse(e),n.node.changeToState("draggedState")},n}return i(t,e),t}(c),f=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onMousemove=function(e){e.preventDefault(),rxEditor.followMouse(e)},n.onMouseout=function(e){e.preventDefault()},n}return i(t,e),t}(s),m=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.classList.push("rx-_-dragged"),n.enter=function(){document.body.classList.add("one-element-dragged")},n.leave=function(){document.body.classList.remove("one-element-dragged")},n}return i(t,e),t}(f),p=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.classList.push("rx-_-editing"),n.enter=function(){n.attributes.contenteditable="true";e.view.$dom;rxEditor.focusedLabel.show(e.label,e,2),rxEditor.toolbar.show(e),rxEditor.focusedNode=e,rxEditor.miniEditbar.show(n.node.view.$dom),rxEditor.commandManager.startEditText(e),e.render()},n.leave=function(){rxEditor.focusedLabel.hide(),rxEditor.toolbar.hide(),rxEditor.focusedNode="",rxEditor.miniEditbar.hide(),rxEditor.commandManager.finishEditText(),n.node.render()},n}return i(t,e),t}(d),v=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onClick=function(){},n}return i(t,e),a(t,[{key:"addtionToModel",value:function(e){return e}}]),t}(s)},352:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}n.d(t,"a",function(){return c});var a=n(233),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),c=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.__screenWidth="md",e.__preview=!1,e.__showMarginX=!0,e.__showMarginY=!0,e.__showOutline=!0,e.__showLabel=!0,e}return r(t,e),s(t,[{key:"screenWidth",get:function(){return this.__screenWidth},set:function(e){this.__screenWidth!=e&&(this.__screenWidth=e,this.distributeEvent("screenWidth"))}},{key:"preview",get:function(){return this.__preview},set:function(e){this.__preview!=e&&(this.__preview=e,this.distributeEvent("preview"))}},{key:"showMarginX",get:function(){return this.__showMarginX},set:function(e){this.__showMarginX!=e&&(this.__showMarginX=e,this.distributeEvent("showMarginX"))}},{key:"showMarginY",get:function(){return this.__showMarginY},set:function(e){this.__showMarginY!=e&&(this.__showMarginY=e,this.distributeEvent("showMarginY"))}},{key:"showOutline",get:function(){return this.__showOutline},set:function(e){this.__showOutline!=e&&(this.__showOutline=e,this.distributeEvent("showOutline"))}},{key:"showLabel",get:function(){return this.__showLabel},set:function(e){this.__showLabel!=e&&(this.__showLabel=e,this.distributeEvent("showLabel"))}}]),t}(a.a)},353:function(e,t,n){"use strict";function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",function(){return y});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=function(){function e(t){r(this,e),this.node=t,this.oldParent=t.parent,this.oldnNextSbiling=t.nextSbiling()}return a(e,[{key:"moveInTop",value:function(e){this.node.moveInTop(e),this.storeNewInfo()}},{key:"moveBefore",value:function(e){this.node.moveBefore(e),this.storeNewInfo()}},{key:"moveAfter",value:function(e){this.node.moveAfter(e),this.storeNewInfo()}},{key:"moveIn",value:function(e){this.node.moveIn(e),this.storeNewInfo()}},{key:"storeNewInfo",value:function(){this.newParent=this.node.parent,this.newNextSbiling=this.node.nextSbiling()}},{key:"adoptFromToolbox",value:function(e){var t=this.node;t&&!t.parent&&e.canAccept(t)&&(t.parent=e,t.render(),t.changeToState("draggedState"))}},{key:"finish",value:function(){var e=this.node;e.parent&&e.parent.changeToState("normalState"),this.makeExcuteSchema()}},{key:"excute",value:function(){this.node.removeFromParent(),this.newNextSbiling?this.node.moveBefore(this.newNextSbiling):this.newParent&&this.newParent.pushChild(this.node),this.makeExcuteSchema()}},{key:"undo",value:function(){this.node.removeFromParent(),this.oldnNextSbiling?this.node.moveBefore(this.oldnNextSbiling):this.oldParent&&this.oldParent.pushChild(this.node),this.makeUndoSchema()}}]),e}(),c=function(e){function t(e){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return i(t,e),a(t,[{key:"makeExcuteSchema",value:function(){this.commandSchema={command:"new",node:this.node.toTreeViewNode(),parentId:this.node.parent?this.node.parent.id:"",nextSblilingId:this.node.nextSbiling()?this.node.nextSbiling().id:""}}},{key:"makeUndoSchema",value:function(){this.commandSchema={command:"delete",nodeId:this.node.id}}}]),t}(s),u=function(e){function t(e){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return i(t,e),a(t,[{key:"makeExcuteSchema",value:function(){this.commandSchema={command:"move",nodeId:this.node.id,oldParentId:this.oldParent?this.oldParent.id:"",parentId:this.node.parent?this.node.parent.id:"",nextSblilingId:this.node.nextSbiling()?this.node.nextSbiling().id:""}}},{key:"makeUndoSchema",value:function(){this.commandSchema={command:"move",nodeId:this.node.id,oldParentId:this.newParent?this.newParent.id:"",parentId:this.node.parent?this.node.parent.id:"",nextSblilingId:this.node.nextSbiling()?this.node.nextSbiling().id:""}}}]),t}(s),l=function(){function e(t){r(this,e),this.node=t,this.oldParent=t.parent,this.oldnNextSbiling=this.node.nextSbiling()}return a(e,[{key:"excute",value:function(){this.node.removeFromParent(),this.makeExcuteSchema()}},{key:"undo",value:function(){this.oldnNextSbiling?this.node.moveBefore(this.oldnNextSbiling):this.oldParent.pushChild(this.node),this.makeUndoSchema()}},{key:"makeExcuteSchema",value:function(){this.commandSchema={command:"delete",nodeId:this.node.id}}},{key:"makeUndoSchema",value:function(){this.commandSchema={command:"new",node:this.node.toTreeViewNode(),parentId:this.node.parent?this.node.parent.id:"",nextSblilingId:this.node.nextSbiling()?this.node.nextSbiling().id:""}}}]),e}(),h=function(){function e(t){r(this,e),this.node=t,this.copy=t.clone()}return a(e,[{key:"excute",value:function(){this.copy.moveAfter(this.node),this.makeExcuteSchema()}},{key:"undo",value:function(){this.copy.removeFromParent(),this.makeUndoSchema()}},{key:"makeExcuteSchema",value:function(){this.commandSchema={command:"new",node:this.copy.toTreeViewNode(),parentId:this.copy.parent?this.copy.parent.id:"",nextSblilingId:this.copy.nextSbiling()?this.copy.nextSbiling().id:""}}},{key:"makeUndoSchema",value:function(){this.commandSchema={command:"delete",nodeId:this.copy.id}}}]),e}(),d=function(){function e(t,n){r(this,e),this.node=t,this.oldMeta=JSON.parse(JSON.stringify(t.meta)),this.newMeta=JSON.parse(JSON.stringify(n))}return a(e,[{key:"excute",value:function(){this.node.meta=JSON.parse(JSON.stringify(this.newMeta)),this.makeExcuteSchema()}},{key:"undo",value:function(){this.node.meta=JSON.parse(JSON.stringify(this.oldMeta)),this.makeUndoSchema()}},{key:"makeExcuteSchema",value:function(){this.commandSchema={command:"change",nodeId:this.node.id,meta:this.node.meta}}},{key:"makeUndoSchema",value:function(){this.commandSchema={command:"change",nodeId:this.node.id,meta:this.node.meta}}}]),e}(),f=function(){function e(t){r(this,e),this.node=t,this.oldChildren=this.node.children,this.node.children.forEach(function(e){e.preview()})}return a(e,[{key:"finish",value:function(){var e=this;this.node.children=rxEditor.nodeParser.parse(this.node.view.$dom.innerHTML),this.node.children.forEach(function(t){t.parent=e.node}),this.newChildren=this.node.children}},{key:"excute",value:function(){this.node.children=this.newChildren,this.makeExcuteSchema()}},{key:"undo",value:function(){this.node.children=this.oldChildren,this.makeUndoSchema()}},{key:"makeExcuteSchema",value:function(){this.commandSchema={command:"textEdit",nodeId:this.node.id,node:this.node.toTreeViewNode()}}},{key:"makeUndoSchema",value:function(){this.commandSchema={command:"textEdit",nodeId:this.node.id,node:this.node.toTreeViewNode()}}}]),e}(),m=function(){function e(t){var n=this;r(this,e),this.node=rxEditor.canvas,this.oldChildren=this.node.children,this.node.children=rxEditor.nodeParser.parse(t),this.node.children.forEach(function(e){e.parent=n.node}),this.newChildren=this.node.children}return a(e,[{key:"excute",value:function(){this.node.children=this.newChildren,this.makeExcuteSchema()}},{key:"undo",value:function(){this.node.children=this.oldChildren,this.makeUndoSchema()}},{key:"makeExcuteSchema",value:function(){this.commandSchema={command:"loadCanvasNodes",nodes:this.node.toTreeViewNode().children}}},{key:"makeUndoSchema",value:function(){this.commandSchema={command:"loadCanvasNodes",nodes:this.node.toTreeViewNode().children}}}]),e}(),p=function(){function e(){r(this,e),this.node=rxEditor.canvas,this.oldChildren=this.node.children,this.node.children=[],this.newChildren=this.node.children}return a(e,[{key:"excute",value:function(){this.node.children=this.newChildren,this.makeExcuteSchema()}},{key:"undo",value:function(){this.node.children=this.oldChildren,this.makeUndoSchema()}},{key:"makeExcuteSchema",value:function(){this.commandSchema={command:"loadCanvasNodes",nodes:this.node.toTreeViewNode().children}}},{key:"makeUndoSchema",value:function(){this.commandSchema={command:"loadCanvasNodes",nodes:this.node.toTreeViewNode().children}}}]),e}(),v=function(){function e(t,n){var o=this;r(this,e),this.node=t,this.oldChildren=this.node.children,this.oldMeta=this.node.meta,this.node.children=[];var i=rxEditor.nodeParser.parse(n);if(i.length>0){var a=i[0];a.children.forEach(function(e){e.parent=o.node,o.node.children.push(e)}),this.node.meta=a.meta}this.newMeta=this.node.meta,this.newChildren=this.node.children}return a(e,[{key:"excute",value:function(){this.node.children=this.newChildren,this.node.meta=this.newMeta,this.makeExcuteSchema()}},{key:"undo",value:function(){this.node.children=this.oldChildren,this.node.meta=this.oldMeta,this.makeUndoSchema()}},{key:"makeExcuteSchema",value:function(){this.commandSchema={command:"loadNode",nodeId:this.node.id,node:this.node.toTreeViewNode()}}},{key:"makeUndoSchema",value:function(){this.commandSchema={command:"loadNode",nodeId:this.node.id,node:this.node.toTreeViewNode()}}}]),e}(),y=function(){function e(){r(this,e),this.undoCommands=[],this.redoCommands=[],this.onCommandsChanged=function(e,t){}}return a(e,[{key:"getDraggedNode",value:function(){if(this.movingCommand)return this.movingCommand.node}},{key:"startNew",value:function(e){var t=new c(e);this.startCommand(t)}},{key:"startMove",value:function(e){var t=new u(e);this.startCommand(t)}},{key:"duplicate",value:function(e){var t=new h(e);t.excute(),this.finished(t),t.node.changeToState("normalState"),t.copy.changeToState("focusState")}},{key:"changeNode",value:function(e,t){var n=new d(e,t.meta);n.excute(),this.finished(n)}},{key:"deleteNode",value:function(e){var t=new l(e);t.excute(),this.finished(t),rxEditor.toolbar.hide(),rxEditor.focusedLabel.hide()}},{key:"loadNodeHtml",value:function(e,t){var n=new v(e,t);n.excute(),this.finished(n)}},{key:"loadCanvasHtml",value:function(e){var t=new m(e);t.excute(),this.finished(t)}},{key:"clearCanvas",value:function(){var e=new p;e.excute(),this.finished(e)}},{key:"startCommand",value:function(e){this.movingCommand=e}},{key:"finishMoving",value:function(){this.movingCommand&&this.movingCommand.node.parent&&(this.finished(this.movingCommand),this.movingCommand.node.changeToState("focusState")),this.movingCommand=""}},{key:"startEditText",value:function(e){this.textCommand=new f(e)}},{key:"finishEditText",value:function(){this.textCommand.finish(),this.finished(this.textCommand),this.textCommand=""}},{key:"finished",value:function(e){this.undoCommands.push(e),this.redoCommands.length=0,this.submitChanged(e)}},{key:"undo",value:function(){var e=this.undoCommands.pop();e.undo(),this.redoCommands.push(e),this.submitChanged(e)}},{key:"redo",value:function(){var e=this.redoCommands.pop();e.excute(),this.undoCommands.push(e),this.submitChanged(e)}},{key:"submitChanged",value:function(e){this.onCommandsChanged(this.undoCommands.length>0,this.redoCommands.length>0,e.commandSchema)}}]),e}()},354:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}n.d(t,"a",function(){return u});var a=n(42),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),c=function e(t,n,o){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,n,o)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(o)},u=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.cssClass("node-label"),e.domAttr("title",$t("can-be-draged")),e.hide(),document.addEventListener("scroll",function(t){e.refreshPosition()}),window.addEventListener("resize",function(t){e.refreshPosition()}),e}return r(t,e),s(t,[{key:"refreshPosition",value:function(){this.followElement(this.node,this.offset)}},{key:"show",value:function(e,n,o){if(this.node=n,this.offset=o,n&&n.view.$dom)return c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setInnerHTML",this).call(this,e),this.followElement(n,o),c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"show",this).call(this)}},{key:"followElement",value:function(e,t){if(e&&e.view&&e.view.$dom){var n=e.view.$dom,o=n.getBoundingClientRect();this.$dom&&(this.$dom.style.left=o.x+"px",o.y<20?this.$dom.style.top=o.y+o.height+t+"px":this.$dom.style.top=o.y-15-t+"px")}}}]),t}(a.a)},355:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}n.d(t,"a",function(){return p});var a=n(42),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),c=function e(t,n,o){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,n,o)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(o)},u=function(e){function t(e,n,r,a){o(this,t);var s=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return s.cssClass("rx-button"),s.domAttr("title",e),s.innerHTML=n,s.domOn(r,a),s}return r(t,e),t}(a.a),l='<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-up" class="svg-inline--fa fa-arrow-up fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"></path></svg>',h='<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrows-alt" class="svg-inline--fa fa-arrows-alt fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M352.201 425.775l-79.196 79.196c-9.373 9.373-24.568 9.373-33.941 0l-79.196-79.196c-15.119-15.119-4.411-40.971 16.971-40.97h51.162L228 284H127.196v51.162c0 21.382-25.851 32.09-40.971 16.971L7.029 272.937c-9.373-9.373-9.373-24.569 0-33.941L86.225 159.8c15.119-15.119 40.971-4.411 40.971 16.971V228H228V127.196h-51.23c-21.382 0-32.09-25.851-16.971-40.971l79.196-79.196c9.373-9.373 24.568-9.373 33.941 0l79.196 79.196c15.119 15.119 4.411 40.971-16.971 40.971h-51.162V228h100.804v-51.162c0-21.382 25.851-32.09 40.97-16.971l79.196 79.196c9.373 9.373 9.373 24.569 0 33.941L425.773 352.2c-15.119 15.119-40.971 4.411-40.97-16.971V284H284v100.804h51.23c21.382 0 32.09 25.851 16.971 40.971z"></path></svg>',d='<svg aria-hidden="true" focusable="false" data-prefix="far" data-icon="edit" class="svg-inline--fa fa-edit fa-w-18" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentColor" d="M402.3 344.9l32-32c5-5 13.7-1.5 13.7 5.7V464c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h273.5c7.1 0 10.7 8.6 5.7 13.7l-32 32c-1.5 1.5-3.5 2.3-5.7 2.3H48v352h352V350.5c0-2.1.8-4.1 2.3-5.6zm156.6-201.8L296.3 405.7l-90.4 10c-26.2 2.9-48.5-19.2-45.6-45.6l10-90.4L432.9 17.1c22.9-22.9 59.9-22.9 82.7 0l43.2 43.2c22.9 22.9 22.9 60 .1 82.8zM460.1 174L402 115.9 216.2 301.8l-7.3 65.3 65.3-7.3L460.1 174zm64.8-79.7l-43.2-43.2c-4.1-4.1-10.8-4.1-14.8 0L436 82l58.1 58.1 30.9-30.9c4-4.2 4-10.8-.1-14.9z"></path></svg>',f='<svg aria-hidden="true" focusable="false" data-prefix="far" data-icon="clone" class="svg-inline--fa fa-clone fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M464 0H144c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h320c26.51 0 48-21.49 48-48v-48h48c26.51 0 48-21.49 48-48V48c0-26.51-21.49-48-48-48zM362 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h42v224c0 26.51 21.49 48 48 48h224v42a6 6 0 0 1-6 6zm96-96H150a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h308a6 6 0 0 1 6 6v308a6 6 0 0 1-6 6z"></path></svg>',m='<svg aria-hidden="true" focusable="false" data-prefix="far" data-icon="trash-alt" class="svg-inline--fa fa-trash-alt fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M268 416h24a12 12 0 0 0 12-12V188a12 12 0 0 0-12-12h-24a12 12 0 0 0-12 12v216a12 12 0 0 0 12 12zM432 80h-82.41l-34-56.7A48 48 0 0 0 274.41 0H173.59a48 48 0 0 0-41.16 23.3L98.41 80H16A16 16 0 0 0 0 96v16a16 16 0 0 0 16 16h16v336a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V128h16a16 16 0 0 0 16-16V96a16 16 0 0 0-16-16zM171.84 50.91A6 6 0 0 1 177 48h94a6 6 0 0 1 5.15 2.91L293.61 80H154.39zM368 464H80V128h288zm-212-48h24a12 12 0 0 0 12-12V188a12 12 0 0 0-12-12h-24a12 12 0 0 0-12 12v216a12 12 0 0 0 12 12z"></path></svg>',p=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.cssClass("node-toolbar"),e.hide(),e.duplicateBtn=new u($t("duplicate"),f,"click",function(){rxEditor.focusedNode&&rxEditor.focusedNode.duplicate(event)}),e.pushChild(new u($t("focus-parent"),l,"click",function(){rxEditor.focusedNode&&rxEditor.focusedNode.up(event)})),e.pushChild(new u($t("move"),h,"mousedown",function(e){rxEditor.focusedNode&&rxEditor.focusedNode.begindragIcon(e)})),e.editButton=new u($t("edit"),d,"mousedown",function(e){rxEditor.focusedNode.changeToState("editState")}),e.editButton.domOn("mouseup",function(e){var t=rxEditor.focusedNode.view.$dom,n=window.getSelection();t.childNodes.length>0&&n.collapse(t,1),t.focus()}),e.pushChild(e.editButton),e.pushChild(e.duplicateBtn),e.pushChild(new u($t("delete"),m,"click",function(){rxEditor.focusedNode&&rxEditor.focusedNode.delete(event)})),document.addEventListener("scroll",function(t){e.refreshPosition()}),window.addEventListener("resize",function(t){e.refreshPosition()}),e}return r(t,e),s(t,[{key:"refreshPosition",value:function(){this.followElement(this.node)}},{key:"show",value:function(e){if(this.node=e,e&&e.view.$dom)return this.followElement(e),this.node.rule.editable?this.editButton.show():this.editButton.hide(),c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"show",this).call(this)}},{key:"followElement",value:function(e){if(e&&e.view&&e.view.$dom){var t=e.view.$dom,n=t.getBoundingClientRect(),o=this.node.rule.editable?0:25;if(this.$dom){var i=n.x+n.width-120;i=i<0?0:i,this.$dom.style.left=i+o+"px",n.y<26?this.$dom.style.top=n.y+n.height+"px":this.$dom.style.top=n.y-26+"px"}}}}]),t}(a.a)},356:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}n.d(t,"a",function(){return u});var a=n(42),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),c=function e(t,n,o){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,n,o)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(o)},u=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.cssClass("rx-cursor"),e.cssClass("out"),e.hide(),e}return r(t,e),s(t,[{key:"hide",value:function(){this.position="",this.node=null,c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"hide",this).call(this)}},{key:"show",value:function(e,n){if(this.position=e,this.node=n,n&&n.view.$dom)return this.classClasses(),this.cssClass("rx-cursor"),this.cssClass(e),this.node=n,"in-top"===e&&this.inTop(n),"in-right"===e&&this.inRight(n),"in-bottom"===e&&this.inBottom(n),"in-left"===e&&this.inLeft(n),"out-top"===e&&this.outTop(n),"out-right"===e&&this.outRight(n),"out-bottom"===e&&this.outBottom(n),"out-left"===e&&this.outLeft(n),"char-left"===e&&this.charLeft(n),"char-right"===e&&this.charRight(n),c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"show",this).call(this)}},{key:"outTop",value:function(e){var t=e.view.$dom,n=t.getBoundingClientRect();this.$dom&&(this.$dom.style.left=n.left+"px",this.$dom.style.top=n.top-2+"px",this.$dom.style.width=n.width+"px",this.$dom.style.height="4px")}},{key:"outRight",value:function(e){var t=e.view.$dom,n=t.getBoundingClientRect();this.$dom&&(this.$dom.style.left=n.right-2+"px",this.$dom.style.right="auto",this.$dom.style.top=n.top+"px",this.$dom.style.width="4px",this.$dom.style.height=n.height+"px")}},{key:"outBottom",value:function(e){var t=e.view.$dom,n=t.getBoundingClientRect();this.$dom&&(this.$dom.style.left=n.x+"px",this.$dom.style.top=n.bottom-2+"px",this.$dom.style.bottom="auto",this.$dom.style.width=n.width+"px",this.$dom.style.height="4px")}},{key:"outLeft",value:function(e){var t=e.view.$dom,n=t.getBoundingClientRect();this.$dom&&(this.$dom.style.left=n.left-2+"px",this.$dom.style.right="auto",this.$dom.style.top=n.top+"px",this.$dom.style.width="4px",this.$dom.style.height=n.height+"px")}},{key:"charRight",value:function(e){var t=e.view.$dom,n=t.getBoundingClientRect();this.$dom&&(this.$dom.style.left=n.right-2+"px",this.$dom.style.right="auto",this.$dom.style.top=n.top+"px",this.$dom.style.width="4px",this.$dom.style.height=n.height+"px")}},{key:"charLeft",value:function(e){var t=e.view.$dom,n=t.getBoundingClientRect();this.$dom&&(this.$dom.style.left=n.left-2+"px",this.$dom.style.right="auto",this.$dom.style.top=n.top+"px",this.$dom.style.width="4px",this.$dom.style.height=n.height+"px")}},{key:"inTop",value:function(e){var t=e.view.$dom,n=t.getBoundingClientRect();this.$dom&&(this.$dom.style.left=n.left+"px",this.$dom.style.top=n.top+1+"px",this.$dom.style.width=n.width+"px",this.$dom.style.height="4px")}},{key:"inRight",value:function(e){var t=e.view.$dom,n=t.getBoundingClientRect();this.$dom&&(this.$dom.style.left=n.right-4+"px",this.$dom.style.right="auto",this.$dom.style.top=n.top+"px",this.$dom.style.width="4px",this.$dom.style.height=n.height+"px")}},{key:"inBottom",value:function(e){var t=e.view.$dom,n=t.getBoundingClientRect();this.$dom&&(this.$dom.style.left=n.x+"px",this.$dom.style.top=n.bottom-4+"px",this.$dom.style.bottom="auto",this.$dom.style.width=n.width+"px",this.$dom.style.height="4px")}},{key:"inLeft",value:function(e){var t=e.view.$dom,n=t.getBoundingClientRect();this.$dom&&(this.$dom.style.left=n.left+"px",this.$dom.style.right="auto",this.$dom.style.top=n.top+"px",this.$dom.style.width="4px",this.$dom.style.height=n.height+"px")}},{key:"followElement",value:function(e){var t=e.view.$dom,n=t.getBoundingClientRect();this.$dom&&(this.$dom.style.left=n.x+"px",this.$dom.style.top=n.height/2+"px",this.$dom.style.width=n.width+"px")}}]),t}(a.a)},357:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}n.d(t,"a",function(){return u});var a=n(42),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),c=function e(t,n,o){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,n,o)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(o)},u=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.cssClass("mouse-follower"),e.hide(),e}return r(t,e),s(t,[{key:"active",value:function(e){c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setInnerHTML",this).call(this,e),this.isActived=!0}},{key:"hide",value:function(){this.isActived=!1,c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"hide",this).call(this)}},{key:"followMouse",value:function(e){this.$dom.style.left=e.clientX,this.$dom.style.top=e.clientY,c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"show",this).call(this)}}]),t}(a.a)},358:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}n.d(t,"a",function(){return f});var a=n(42),s=n(233),c=function e(t,n,o){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,n,o)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(o)},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),l=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.__bold=!1,e.__italic=!1,e.__underline=!1,e.__strikeThrough=!1,e.__isLink=!1,e}return r(t,e),u(t,[{key:"bold",get:function(){return this.__bold},set:function(e){this.__bold!=e&&(this.__bold=e,this.distributeEvent("bold"))}},{key:"italic",get:function(){return this.__italic},set:function(e){this.__italic!=e&&(this.__italic=e,this.distributeEvent("italic"))}},{key:"underline",get:function(){return this.__underline},set:function(e){this.__underline!=e&&(this.__underline=e,this.distributeEvent("underline"))}},{key:"strikeThrough",get:function(){return this.__strikeThrough},set:function(e){this.__strikeThrough!=e&&(this.__strikeThrough=e,this.distributeEvent("strikeThrough"))}},{key:"isLink",get:function(){return this.__isLink},set:function(e){this.__isLink!=e&&(this.__isLink=e,this.distributeEvent("isLink"))}}]),t}(s.a),h=function(e){function t(e,n){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.cssClass("mini-button"),r.domAttr("title",e),r.domOn("click",n),r}return r(t,e),t}(a.a),d=function(){if(""!==window.getSelection().toString){var e=window.getSelection();return!!(e=e.rangeCount>0?e.getRangeAt(0):"")&&("A"===e.startContainer.parentNode.tagName||"A"===e.endContainer.parentNode.tagName)}},f=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e.cssClass("mini-editbar"),e.hide(),e.state=new l,e.domOn("mousedown",function(e){e.preventDefault()});var n=new h("Bold",function(){document.execCommand("bold",!1,null),e.updateButtonsState()}).cssClass("icon-button").setInnerHTML("<b>B</b>");e.pushChild(n);var r=new h("Italic",function(){document.execCommand("italic",!1,null),e.state.italic=!e.state.italic}).cssClass("icon-button").setInnerHTML("<i>I</i>");e.pushChild(r);var a=new h("Underline",function(){document.execCommand("underline",!1,null),e.updateButtonsState()}).cssClass("icon-button").setInnerHTML("<u>U</u>");e.pushChild(a);var s=new h("Strike",function(){document.execCommand("strikeThrough",!1,null),e.updateButtonsState()}).cssClass("icon-button").setInnerHTML("<strike>S</strike>");e.pushChild(s);var c=new h("Link",function(){e.state.isLink?document.execCommand("unlink",!1,null):document.execCommand("createLink",!1,"#"),e.updateButtonsState()}).cssClass("icon-button").setInnerHTML('<div style="transform:rotate(45deg)">⫘</div>');return e.pushChild(c),document.onpaste=function(e){var t=e.clipboardData.getData("text/plain").replace(/[\r\n]/g,"<br>");return document.execCommand("insertHTML",!1,t),!1},document.addEventListener("keydown",function(e){if(13===e.keyCode)return document.execCommand("insertHTML",!1,"<br>"),e.preventDefault(),!1}),e.watchOne("bold",n),e.watchOne("italic",r),e.watchOne("underline",a),e.watchOne("strikeThrough",s),e.watchOne("isLink",c),document.addEventListener("scroll",function(t){e.followElement(e.domElement)}),window.addEventListener("resize",function(t){e.followElement(e.domElement)}),e}return r(t,e),u(t,[{key:"watchOne",value:function(e,t){var n=this;this.state.watch(e,function(){n.state[e]?t.cssClass("active"):t.removeCssClass("active")})}},{key:"show",value:function(e){var n=this;if(e)return this.followElement(e),this.updateButtonsState(),document.addEventListener("selectionchange",function(e){n.updateButtonsState()}),c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"show",this).call(this)}},{key:"hide",value:function(){var e=this;return document.removeEventListener("selectionchange",function(t){e.updateButtonsState()}),c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"hide",this).call(this)}},{key:"updateButtonsState",value:function(){this.isShow()&&(this.state.bold=document.queryCommandState("bold"),this.state.italic=document.queryCommandState("italic"),this.state.underline=document.queryCommandState("underline"),this.state.strikeThrough=document.queryCommandState("strikeThrough"),this.state.isLink=d())}},{key:"followElement",value:function(e){if(e){this.domElement=e;var t=e.getBoundingClientRect();this.$dom&&(this.$dom.style.left=t.x-1+"px",t.y<32?this.$dom.style.top=t.y+t.height+"px":this.$dom.style.top=t.y-32+"px")}}}]),t}(a.a)},359:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",function(){return l});var i=n(360),r=n(362),a=n(236),s=n(363),c=n(237),u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),l=function(){function e(){o(this,e),this.$dom=document.createElement("div")}return u(e,[{key:"parse",value:function(e){this.$dom.innerHTML=e;for(var t=[],n=0;n<this.$dom.childNodes.length;n++){var o=this.paraseNode(this.$dom.childNodes[n]);o&&t.push(o)}return t}},{key:"paraseNode",value:function(e,t){var n;if(3===e.nodeType){var o=e.textContent;if(!o)return"";var r=new a.a(o);return r.parent=t,r}if(8===e.nodeType)return"";e.classList.contains("container")&&(n=new i.a("container"));var s=this.parseClassNode(e);n=s||this.parseTagNode(e),this.copyClassList(e.classList,n.meta.classList);for(var c=0;c<e.childNodes.length;c++){var u=e.childNodes[c],l=this.paraseNode(u,n);l&&n.children.push(l)}return this.parseAttributes(n,e),n.markDefaultMeta(),n.parent=t,n}},{key:"parseAttributes",value:function(e,t){for(var n=t.attributes,o=0;o<n.length;o++){var i=n[o].nodeName,r=n[o].nodeValue;"class"!==i.toLowerCase()&&(e.meta.attributes[i]=r)}}},{key:"parseClassNode",value:function(e){for(var t in s.a.classRules){var n=s.a.classRules[t];n.classes=n.classes?n.classes:[t];for(var o=0;o<n.classes.length;o++){var r=n.classes[o].toLowerCase();if(e.classList.contains(r)){var a=new i.a(r);return a.meta.tag=e.tagName.toLowerCase(),a.setLabel(n.label?n.label:t),a.ruleName=t,a.rule=n,a}}}}},{key:"parseTagNode",value:function(e){var t,n=e.tagName.toLowerCase();for(var o in s.a.tagRules){var i=s.a.tagRules[o];i.tags=i.tags?i.tags:[o];for(var a=0;a<i.tags.length;a++){var u=i.tags[a];if(n===u.toLowerCase())return t=new r.a(u),t.setLabel(i.label?i.label:o),t.ruleName=o,t.rule=i,t}}return t=new r.a(n),t.ruleName=n,t.rule=Object.assign({},c.a),t}},{key:"copyClassList",value:function(e,t){e.forEach(function(e){0!==e.indexOf("rx-_-")&&t.push(e)})}}]),e}()},360:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}n.d(t,"a",function(){return c});var a=n(235),s=(n(5),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),c=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.cssClass=e,n}return r(t,e),s(t,[{key:"make",value:function(){return new t(this.cssClass)}}]),t}(a.a)},361:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}n.d(t,"a",function(){return c});var a=n(206),s=(n(5),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),c=function(e){function t(e,n){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.parent=n,r.char=e,r.isCharNode=!0,r.rule={},r.rule.acceptedChildren=[],r.rule.editMarginStyle={},r.rule.dropInMargin=5,r}return r(t,e),s(t,[{key:"make",value:function(){return new t}},{key:"changeTextnodeToCharNode",value:function(){}},{key:"toViewModel",value:function(){return{styles:{},classList:["char-node"],attributes:{},innerHTML:this.char,tag:"span",on:{onmousemove:this.mousemove,onmouseover:this.mouseover,onmouseout:this.mouseout}}}}]),t}(a.a)},362:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}n.d(t,"a",function(){return c});var a=n(235),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),c=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.meta.tag=e,n.label=e,n.labelToCapitalize(),n}return r(t,e),s(t,[{key:"make",value:function(){var e=new t(this.meta.tag);return e.label=this.label,e}}]),t}(a.a)},363:function(e,t,n){"use strict";var o=n(364),i=n(365),r=n(366),a=n(367),s=n(237);t.a={classRules:{container:o.a,row:i.a,col:r.a,"w-100":Object.assign({},s.a),alert:Object.assign({},s.a)},tagRules:{heading:a.a}}},364:function(e,t,n){"use strict";t.a={dropInMargin:10,editable:!1,editMarginStyle:{paddingX:"30px",paddingY:"30px"},empertyMargin:!0,rejectChildren:["col","thead","tbody","th","tr","td"]}},365:function(e,t,n){"use strict";t.a={dropInMargin:10,editable:!1,editMarginStyle:{paddingX:"20px",paddingY:"20px"},empertyMargin:!0,acceptChildren:["col","w-100"]}},366:function(e,t,n){"use strict";t.a={label:"column",dropInMargin:10,editable:!0,editMarginStyle:{paddingX:"20px",paddingY:"20px"},empertyMargin:!0,classes:["col","col-1","col-2","col-3","col-4","col-5","col-6","col-7","col-8","col-9","col-10","col-11","col-12","col-sm","col-sm-1","col-sm-2","col-sm-3","col-sm-4","col-sm-5","col-sm-6","col-sm-7","col-sm-8","col-sm-9","col-sm-10","col-sm-11","col-sm-12","col-md","col-md-1","col-md-2","col-md-3","col-md-4","col-md-5","col-md-6","col-md-7","col-md-8","col-md-9","col-md-10","col-md-11","col-md-12","col-lg","col-lg-1","col-lg-2","col-lg-3","col-lg-4","col-lg-5","col-lg-6","col-lg-7","col-lg-8","col-lg-9","col-lg-10","col-lg-11","col-lg-12","col-xl","col-xl-1","col-xl-2","col-xl-3","col-xl-4","col-xl-5","col-xl-6","col-xl-7","col-xl-8","col-xl-9","col-xl-10","col-xl-11","col-xl-12"],rejectChildren:["col","thead","tbody","th","tr","td"]}},367:function(e,t,n){"use strict";t.a={label:"Heading",tags:["h1","h2","h3","h4","h5","h6"],editable:!0,editMarginStyle:{paddingX:"5px",paddingY:"5px"}}},42:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",function(){return a});var i=n(5),r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div";o(this,e),this.children=[],this.classList=[],this.style={},this.attrs={},this.domOns={},this.elementName=t}return r(e,[{key:"on",value:function(e,t){return this[e]=t,this}},{key:"off",value:function(e){return delete this[e],this}},{key:"domOn",value:function(e,t){return this.$dom&&this.$dom.addEventListener(e,t),this.domOns[e]=t,this}},{key:"domOff",value:function(e,t){return this.$dom&&this.$dom.removeEventListener(e,t),delete this.domOns[e],this}},{key:"pushChild",value:function(e){return this.children.push(e),this}},{key:"unshiftChild",value:function(e){return this.children.unshift(e),this}},{key:"cssClass",value:function(e){return Object(i.a)(e,this.classList),this.$dom&&this.$dom.classList.add(e),this}},{key:"removeCssClass",value:function(e){return Object(i.d)(e,this.classList)&&(Object(i.i)(e,this.classList),this.$dom&&this.$dom.classList.contains(e)&&this.$dom.classList.remove(e)),this}},{key:"cssStyle",value:function(e,t){return this.style[e]=t,this}},{key:"removeCssStyle",value:function(e){delete this.style[e]}},{key:"domAttr",value:function(e,t){return this.attrs[e]=t,this}},{key:"removeDomAttr",value:function(e){return delete this.attrs[e],this}},{key:"tongle",value:function(e){Object(i.d)(e,this.classList)?(Object(i.i)(e,this.classList),this.$dom&&Object(i.i)(e,this.$dom.classList)):(Object(i.a)(e,this.classList),this.$dom&&Object(i.a)(e,this.$dom.classList))}},{key:"render",value:function(e){var t=this;this.$dom=document.createElement(this.elementName),e.appendChild(this.$dom),this.innerHTML&&(this.$dom.innerHTML=this.innerHTML);for(var n in this.style)this.$dom.style[n]=this.style[n];this.classList.forEach(function(e){t.$dom.classList.add(e)});for(var o in this.attrs)this.$dom[o]=this.attrs[o];for(var i in this.domOns)this.$dom.addEventListener(i,this.domOns[i]);return this.children.forEach(function(e){e.render(t.$dom)}),this}},{key:"refresh",value:function(){if(this.$dom){var e=this.$dom.parentNode;this.destory(),this.render(e)}}},{key:"setInnerHTML",value:function(e){return this.innerHTML=e,this.$dom&&(this.$dom.innerHTML=e),this}},{key:"destory",value:function(){this.$dom.parentNode.removeChild(this.$dom),this.$dom=""}},{key:"removeChild",value:function(e){Object(i.i)(e,this.children),this.$dom&&e.$dom&&this.$dom.contains(e.$dom)&&this.$dom.removeChild(e.$dom)}},{key:"clearChild",value:function(){this.children=new RXArray}},{key:"classClasses",value:function(){var e=this.$dom;e&&this.classList.forEach(function(t){e.classList.remove(t)}),this.classList.length=0}},{key:"show",value:function(){return this.style.display="flex",this.$dom&&(this.$dom.style.display="flex"),this}},{key:"isShow",value:function(){return"none"!==this.style.display}},{key:"hide",value:function(){return this.style.display="none",this.$dom&&(this.$dom.style.display="none"),this}},{key:"insertBefore",value:function(e,t){Object(i.g)(e,t,this.children)}}]),e}()},5:function(e,t,n){"use strict";function o(e){if(e.length>0)return e[0]}function i(e){if(e.length>0)return e[e.length-1]}function r(e,t){for(var n=0;n<t.length;n++)if(t[n]===e&&n>0)return t[n-1]}function a(e,t){for(var n=0;n<t.length;n++)if(t[n]===e&&n<t.length)return t[n+1]}function s(e,t,n){for(var o=0;o<n.length;o++)if(n[o]===t)return void n.splice(o,0,e);n.push(e)}function c(e,t,n){for(var o=0;o<n.length;o++)if(n[o]===t)return void n.splice(o+1,0,e)}function u(e,t){for(var n=0;n<t.length;n++)if(t[n]===e){t.splice(n,1);break}}function l(e,t){h(e,t)||t.push(e)}function h(e,t){for(var n=0;n<t.length;n++)if(t[n]===e)return!0;return!1}function d(e,t,n){e?l(t,n):u(t,n)}t.e=o,t.h=i,t.c=r,t.b=a,t.g=s,t.f=c,t.i=u,t.a=l,t.d=h,t.j=d}});
//# sourceMappingURL=core.js.map